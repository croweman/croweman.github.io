<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Book Keeping</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
        .clear {
            clear: both;
        }
        .inputMargin {
            margin-top:5px;
        }
        .marginBottom {
            margin-bottom: 5px;
        }
        #customerDetails, #createCustomerError, #searchError, #results, #findCustomer, #createBookEntryError {
            display: none;
        }

        #bookEntry {
            display: none;
        }

        input[type=file] {
            display: inline-block;
        }

        body {
            margin-bottom: 20px;
        }

        .has-danger {
            color: #d9534f;
        }

        .has-danger .form-control {
            border-color: #d9534f;
        }

        .has-success {
            color: #5cb85c;
        }

        .has-success .form-control {
            border-color: #5cb85c;
        }
    </style>
    <script type="text/JavaScript">
        var openRequest;
        var db;
        var miles = 0;
        var timeOptions = [];
        var bookEntry;
        var allCustomers = [];
        var monthNames = ["January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];
        var defaultWhen = getWhen(new Date());

        function addCustomer(customer, successCallback) {
            var customersTransaction = db.transaction("customer", "readwrite");
            var customersStore = customersTransaction.objectStore('customer');

            let request = customersStore.add(customer);

            request.onsuccess = successCallback;
        }

        function addBookEntry(bookEntry, successCallback) {
            var bookyEntryTransaction = db.transaction("bookEntry", "readwrite");
            var bookEntryStore = bookyEntryTransaction.objectStore('bookEntry');

            let request = bookEntryStore.add(bookEntry);

            request.onsuccess = successCallback;
        }

        function updateBookEntryRecord(bookEntry, successCallback) {
            var bookyEntryTransaction = db.transaction("bookEntry", "readwrite");
            var bookEntryStore = bookyEntryTransaction.objectStore('bookEntry');

            let request = bookEntryStore.put(bookEntry);

            request.onsuccess = successCallback;
        }

        function createCustomer() {
            $('#createCustomerModal').click(function() {
                $('#bookEntries').hide();
                $('#bookEntry').hide();
                $('#findCustomer').hide();
                $('#createCustomerError').hide();
                $('#name').val('');
                $('#addressLine1').val('');
                $('#town').val('March');
                $('#postcode').val('-');
                $('#miles').val('0');
                $('#customerDetails').show();
                $('#name').focus();
            });

            $('#createCustomer').click(function() {
                $('#createCustomerError').hide();
                var name = $('#name').val().trim();
                var addressLine1 = $('#addressLine1').val().trim();
                var town = $('#town').val().trim();
                var postcode = $('#postcode').val().trim();
                var miles = $('#miles').val().trim();

                let milesRegEx = new RegExp(/^[0-9]+(\.[0-9]{1,2}){0,1}$/);

                if (name.length === 0 || addressLine1.length === 0 || town.length === 0 || postcode.length === 0 || !milesRegEx.test(miles)) {
                    $('#createCustomerError').show();
                    return;
                }

                var customer = {
                    name: name,
                    addressLine1: addressLine1,
                    town: town,
                    postcode: postcode,
                    miles: parseFloat(miles),
                    full: (name + addressLine1 + town + postcode).toLowerCase()
                };
                
                addCustomer(customer, function() {
                    getAllCustomers(function(customers) {
                        allCustomers = customers;
                        $('#customerDetails').hide();
                        $('#createBookEntryModal')[0].scrollIntoView();
                    });
                });
            });
        }

        function createBookEntry() {
            $('#createBookEntryModal').click(function() {
                $('#createBookEntry').show();
                $('#updateBookEntry').hide();
                $('#bookEntries').hide();
                $('#createBookEntryError').hide();
                $('#customerDetails').hide();
                $('#findCustomer').hide();
                $('#bookEntry').show();

                $('#customerId').val('');
                $('#when').val(defaultWhen);
                document.getElementById('whenTime').selectedIndex = 0;
                $('#amount').val('');
                $('#summary').val('');
            });

            $('#customerId').click(function() {
                $('#bookEntry').hide();
                showFindCustomer();
            });

            $('#createBookEntry').click(function() {
                var customerId = $('#customerId').val().trim();
                var when = $('#when').val();
                var whenTime = $('#whenTime').val();
                var amount = $('#amount').val();
                var summary = $('#summary').val();

                let moneyRegEx = new RegExp(/^[0-9]+(\.[0-9]{2}){0,1}$/);

                var valid = customerId.length > 0 && when.length > 0 && moneyRegEx.test(amount) && summary.length > 0;

                if (!valid) {
                    $('#createBookEntryError').show();
                    return;
                }

                if (miles === undefined || miles === null)
                    miles = 0;

                var bookEntry = {
                    customer: customerId,
                    when: new Date(when + 'T' + whenTime),
                    summary: summary,
                    amount: parseFloat(amount),
                    miles: parseFloat(miles)
                };

                addBookEntry(bookEntry, function(e) {
                    bookEntry.id = e.target.result;
                    $('#bookEntry').hide();
                    $('#createBookEntryModal')[0].scrollIntoView();
                    populateBookEntries([ bookEntry ], true);
                });
            });
        }

        function editBookEntry(id, milesVal) {
            miles = milesVal;
            getBookEntryById(id, function(bookEntryInstance) {
                bookEntry = bookEntryInstance;
                $('#bookEntries').hide();
                $('#createBookEntryError').hide();
                $('#customerDetails').hide();
                $('#findCustomer').hide();
                $('#bookEntry').show();
                $('#createBookEntry').hide();
                $('#updateBookEntry').show();

                $('#customerId').val(bookEntry.customer);
                var when = bookEntry.when.toISOString();
                var date = when.substr(0, when.indexOf('T'));
                $('#when').val(date);
                $('#amount').val(bookEntry.amount.toString());
                $('#summary').val(bookEntry.summary);

                document.getElementById('whenTime').selectedIndex = 0;

                var time = when.substr(when.indexOf('T') + 1);
                time = time.substr(0, 5);

                for (var i = 0; i < timeOptions.length; i++) {
                    if (timeOptions[i].text === time) {
                        document.getElementById('whenTime').selectedIndex = i;
                        break;
                    }
                }
            })
        }

        function updateBookEntry() {
            $('#updateBookEntry').click(function() {
                var customerId = $('#customerId').val().trim();
                var when = $('#when').val();
                var whenTime = $('#whenTime').val();
                var amount = $('#amount').val();
                var summary = $('#summary').val();

                let moneyRegEx = new RegExp(/^[0-9]+(\.[0-9]{2}){0,1}$/);

                var valid = customerId.length > 0 && when.length > 0 && moneyRegEx.test(amount) && summary.length > 0;

                if (!valid) {
                    $('#createBookEntryError').show();
                    return;
                }

                if (miles === undefined || miles === null)
                    miles = 0;

                bookEntry.customer = customerId;
                bookEntry.when = new Date(when + 'T' + whenTime);
                bookEntry.summary = summary;
                bookEntry.amount = parseFloat(amount);
                bookEntry.miles = parseFloat(miles);

                updateBookEntryRecord(bookEntry, function() {
                    $('#bookEntry').hide();
                    $('#createBookEntryModal')[0].scrollIntoView();
                    populateBookEntries();
                });
            });
        }

        function showFindCustomer() {
            $('#findCustomer').show();
            $('#filter').val('');
            $('#resultsBody').empty();
            $('#results').hide();
            $('#filter').focus();
            $('#createBookEntryModal')[0].scrollIntoView();
        }

        function findCustomer() {
            $('#resultsBody').empty();
            $('#searchError').hide();

            var filter = $('#filter').val().trim().toLowerCase();

            if (filter.length === 0) {
                return;
            }

            var html = '';

            var customers = allCustomers.filter(function(item) {return item.full.indexOf(filter) !== -1; });

            customers.forEach(function(customer) {
                html += '<tr><td><input type="radio" name="customerradio" onclick="javascript:selectChosenCustomer();" value="' + customer.id + '" data-miles="' + customer.miles + '" data-summary="' + customer.name + ', ' + customer.addressLine1 + ', ' + customer.town + '"></td><td>' + customer.name  + '</td><td>' + customer.addressLine1  + '</td><td>' + customer.town + '</td></tr>';
            });

            $('#results').show();
            $('#resultsBody').append(html);
        }

        function selectChosenCustomer() {
            var input = $("input:radio[name='customerradio']:checked");

            var id = input.val();

            if (id === undefined) return;

            $('#findCustomer').hide();
            $('#bookEntry').show();
            $('#customerId').val(id + ' - ' + input.data().summary);
            $('#createBookEntryError').hide();
            miles = parseFloat(input.data().miles)
        };

        function orderBookEntries(bookEntries) {
            // could probably be done via an index somehow on query!!!!!!!!!!
            var sortedBookEntries = bookEntries.sort(function(a, b){
                return b.when - a.when; 
                }
            );

            return sortedBookEntries;
        }

        function getFormattedDate(date) {
            var year = date.getFullYear();

            var month = (1 + date.getMonth()).toString();
            month = month.length > 1 ? month : '0' + month;

            var day = date.getDate().toString();
            day = day.length > 1 ? day : '0' + day;

            var hour = date.getHours().toString();
            hour = hour.length > 1 ? hour : '0' + hour
            
            var minute = date.getMinutes().toString();
            minute = minute.length > 1 ? minute : '0' + minute;
            
            return day + '/' + month + '/' + year + ' ' + hour + ':' + minute;
        }

        function getWhen(date) {
            var year = date.getFullYear();

            var month = (1 + date.getMonth()).toString();
            month = month.length > 1 ? month : '0' + month;

            var day = date.getDate().toString();
            day = day.length > 1 ? day : '0' + day;
            
            return year + '-' + month + '-' + day;
        }

        var deleting = false;
        function deleteBookEntry(index) {
            if (deleting) return;

            var result = confirm('Are you sure?');

            if (!result) return;

            deleting = true;
            
            var bookEntriesTransaction = db.transaction("bookEntry", "readwrite");
            var bookEntriesStore = bookEntriesTransaction.objectStore('bookEntry');

            var request = bookEntriesStore.delete(index);

            request.onsuccess = function(event) {
                populateBookEntries();
                deleting = false;
            };
        }

        function getAllBookEntries(successCallback) {
            var bookEntriesTransaction = db.transaction("bookEntry", "readwrite");
            var bookEntriesStore = bookEntriesTransaction.objectStore('bookEntry');
            var allRecords = bookEntriesStore.getAll();

            allRecords.onsuccess = function() {
                successCallback(allRecords.result);
            };
        }

        function getAllCustomers(successCallback) {
            var customersTransaction = db.transaction("customer", "readwrite");
            var customersStore = customersTransaction.objectStore('customer');
            var allRecords = customersStore.getAll();

            allRecords.onsuccess = function() { 
                var results = allRecords.result.sort(function(a, b){
                    var aFull = a.full.toLowerCase();
                    var bFull = b.full.toLowerCase();
                    if (aFull < bFull) { return -1; }
                    if (aFull > bFull) { return 1; }
                    return 0;
                });
                successCallback(results);
            };
        }

        function getBookEntryById(id, successCallback) {
            var bookEntriesTransaction = db.transaction("bookEntry", "readwrite");
            var bookEntriesStore = bookEntriesTransaction.objectStore('bookEntry');
            var record = bookEntriesStore.get(id);

            record.onsuccess = function() {
                successCallback(record.result);
            };
        }

        function getDateLabel(date) {
            return monthNames[date.getMonth()] + ' ' + date.getFullYear();
        }

        function toggleTable(tableId) {
            var visible = $('#' + tableId + ':visible').length > 0;
            
            var buttonText = $('#' + tableId + 'Button').text();

            if (visible) {
                $('#' + tableId).hide();
                buttonText = buttonText.substr(0, buttonText.length - 1) + '+';
            } else {
                $('#' + tableId).show();
                buttonText = buttonText.substr(0, buttonText.length - 1) + '-';
            }

            $('#' + tableId + 'Button').text(buttonText);
        }

        function populateBookEntries(providedBookEntries, removeCollapseButton) {
            $('#bookEntry').hide();
            $('#customerDetails').hide();
            $('#findCustomer').hide();
            $('#bookEntries').show();

            $('#bookEntriesSummary').show();

            var html = "";
            var total = 0;
            var totalMiles = 0;

            function callback(bookEntries) {
                var bookEntries = orderBookEntries(bookEntries);

                var data = {};
                var keys = [];

                bookEntries.forEach(function(bookEntry) {
                    var key = getDateLabel(bookEntry.when);
                    
                    if (!data[key]) {
                        data[key] = [];
                        keys.push(key);
                    }

                    data[key].push(bookEntry);
                });

                var expand = true;

                keys.forEach(function(key) {
                    var currentTotal = 0;
                    var currentMiles = 0;

                    data[key].forEach(function(bookEntry) {
                        var miles = bookEntry.miles;

                        if (miles === undefined || miles === null)
                            miles = 0;

                        total += bookEntry.amount;
                        currentTotal += bookEntry.amount;
                        totalMiles += miles;
                        currentMiles += miles;
                    });

                    var tableId = key.replace(' ', '');
                    var entries = data[key].length;
                    var buttonAdditionalText = '&nbsp;&nbsp;(' + entries + ' ' + (entries === 1 ? 'entry' : 'entries') + ')';

                    if (!removeCollapseButton) {
                        html += '<div class="form-group"><button id="' + tableId + 'Button"class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample" onclick="toggleTable(\'' + tableId + '\')">' + key + ' ' + buttonAdditionalText + ' ' + (expand ? '-' : '+') + '</button></div>';
                    }
                    
                    html += '<div id="' + tableId + '"' + (expand ? '' : ' style="display:none"') + ' class="form-group"><label>Amount: £' + currentTotal.toFixed(2) + '</label><br /><label>Miles: ' + currentMiles.toFixed(2) + '</label>';
                    html += '<table class="table"><thead><tr><th>Date</th><th>Customer</th><th>Amount</th><th>Miles</th><th>Summary of work</th><th>Edit</th><th>Delete</th></tr></thead><tbody>';

                    data[key].forEach(function(bookEntry) {
                        html += '<tr><td>' + getFormattedDate(bookEntry.when) + '</td><td>' + bookEntry.customer + '</td><td>£' + bookEntry.amount.toFixed(2) + '</td><td>' + miles + '</td><td>' + bookEntry.summary + '</td><td><button type="button" class="btn btn-default" onclick="editBookEntry(' + bookEntry.id  + ', ' + miles + ')">Edit</button></td><td><button type="button" class="btn btn-default" onclick="deleteBookEntry(' + bookEntry.id  + ')">Delete</button></td></tr>';
                    });

                    html += '</tbody></table></div>';
                    expand = false;
                });

                $('#bookEntriesBody').html(html)
                $('#bookEntries').show();
                $('#total').html(total.toFixed(2));
                $('#totalMiles').html(totalMiles.toFixed(2));
            }

            if (providedBookEntries !== undefined) {
                $('#bookEntriesSummary').hide();
                callback(providedBookEntries);
                return;
            }

            getAllBookEntries(callback);
            
        }

        function download() {
            getAllBookEntries(function(bookEntries) {
                getAllCustomers(function(customers) {
                    var data = {
                        bookEntries: bookEntries,
                        customers: customers
                    };

                    var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
                    var dlAnchorElem = document.getElementById('downloadAnchorElem');
                    dlAnchorElem.setAttribute("href", dataStr);
                    var name = getFormattedDate(new Date());
                    name = name.replace(' ', '_');
                    name = name.replace(':', '-');
                    name = name.replace(/\//g, '-');
                    dlAnchorElem.setAttribute('download', 'book-entries-' + name + '.json');
                    dlAnchorElem.click();
                })
            });
        }

        function openFile(event) {
            var input = event.target;

            var reader = new FileReader();
            reader.onload = function() {
                var json = reader.result;
                var state = JSON.parse(json);

                var customersTransaction = db.transaction("customer", "readwrite");
                var customersStore = customersTransaction.objectStore('customer');
                customersStore.clear();

                state.customers.forEach(function(customer) {
                    addCustomer(customer, function() {});
                })

                var bookyEntryTransaction = db.transaction("bookEntry", "readwrite");
                var bookEntryStore = bookyEntryTransaction.objectStore('bookEntry');
                bookEntryStore.clear();

                state.bookEntries.forEach(function(bookEntry) {
                    bookEntry.when = new Date(bookEntry.when);
                    addBookEntry(bookEntry, function() {});
                })

                populateBookEntries();
            };

            reader.readAsText(input.files[0]);
        };

        function initialise() {
            openRequest = indexedDB.open('BookKeeping', 1);
            
            openRequest.onupgradeneeded = function() {
                db = openRequest.result;
                if (!db.objectStoreNames.contains('customer')) {
                    var store = db.createObjectStore('customer', { keyPath: 'id', autoIncrement: true });
                    store.createIndex('full', ['full'], { unique:false });
                }

                if (!db.objectStoreNames.contains('bookEntry'))
                    db.createObjectStore('bookEntry', { keyPath: 'id', autoIncrement: true });
            };

            openRequest.onsuccess = function() {
                db = openRequest.result;

                createCustomer();
                createBookEntry();
                updateBookEntry();
                findCustomer();
                populateBookEntries();

                $('#downloadButton').click(function() {
                    download();
                });

                var date = new Date().toISOString();
                date = date.substr(0, date.indexOf('T'));
                $('#defaultWhen').val(date);

                timeOptions = document.getElementById('whenTime').options;

                var timeout;
                $('#filter').on('keyup input', function() {
                    clearTimeout(timeout);
                    timeout = setTimeout(findCustomer, 100);
                });

                getAllCustomers(function(customers) {
                    allCustomers = customers;
                });
            };
        }
        
    </script>
  </head>
  <body>
      <div class="col-md-12" style="padding-left: 0">
        <nav class="navbar navbar-expand-lg navbar-light bg-light" style="background-color: #292b2c; border-radius: 0">
            <a class="navbar-brand" href="#" style="color:white">Book Keeping</a>
        </nav>
        <div class="col-md-12">
            <input type="file" id="import" name="import" class="btn btn-default" accept="application/json" onchange="openFile(event)">
            <button id="downloadButton" type="button" class="btn btn-default btn-primary">Download</button>
            <br /><br />
        </div>
        <div class="col-md-12 clear inputMargin marginBottom">
            <button id="createBookEntryModal" type="button" class="btn btn-default btn-primary">Entry +</button>
            <button id="createCustomerModal" type="button" class="btn btn-default btn-primary">Customer +</button>
            <button id="showAllBookEntries" type="button" class="btn btn-default btn-primary" onclick="javascript:populateBookEntries();">All Entries</button>
        </div>
        
        <a id="downloadAnchorElem" style="display:none"></a>
        <div id="customerDetails" class="col-md-12 clear">
            <form autocomplete="off">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Customer Details</h3>
                    </div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label for="name">Name</label>
                            <input id="name" class="form-control" required="" autofocus="">
                        </div>
                        <div class="form-group">
                            <label for="addressLine1">Address Line 1</label>
                            <input id="addressLine1" class="form-control" required="" onClick="this.select();">
                        </div>
                        <div class="form-group">
                            <label for="town">Town</label>
                            <input id="town" class="form-control" required="" onClick="this.select();">
                        </div>
                        <div class="form-group">
                            <label for="postcode">Postcode</label>
                            <input id="postcode" class="form-control" required="" onClick="this.select();">
                        </div>
                        <div class="form-group">
                            <label for="miles">Miles</label>
                            <input id="miles" class="form-control" required="" onClick="this.select();">
                        </div>
                        <div id="createCustomerError" class="alert alert-danger" role="alert">
                            Populate fields correctly!
                        </div>
                        <button id="createCustomer" type="button" class="btn btn-default btn-primary inputMargin" type="submit">Add Customer</button>
                    </div>
                </div>
            </form>
        </div>

        <div id="bookEntry" class="col-md-12 clear">
            <form autocomplete="off">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Book entry</h3>
                    </div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label for="customerId">Customer</label>
                            <input id="customerId" class="form-control" required="" readonly="readonly">
                        </div>
                        <div class="form-group">
                            <label for="when">When</label>
                            <input id="when" type="date" class="form-control" required="" onchange="javascript:defaultWhen = $('#when').val();">
                            <select id="whenTime" class="form-control" style="margin-top: 8px;">
                                <option>09:00</option>
                                <option>09:15</option>
                                <option>09:30</option>
                                <option>09:45</option>
                                <option>10:00</option>
                                <option>10:15</option>
                                <option>10:30</option>
                                <option>10:45</option>
                                <option>11:00</option>
                                <option>11:15</option>
                                <option>11:30</option>
                                <option>11:45</option>
                                <option>12:00</option>
                                <option>12:15</option>
                                <option>12:30</option>
                                <option>12:45</option>
                                <option>13:00</option>
                                <option>13:15</option>
                                <option>13:30</option>
                                <option>13:45</option>
                                <option>14:00</option>
                                <option>14:15</option>
                                <option>14:30</option>
                                <option>14:45</option>
                                <option>15:00</option>
                                <option>15:15</option>
                                <option>15:30</option>
                                <option>15:45</option>
                                <option>16:00</option>
                                <option>16:15</option>
                                <option>16:30</option>
                                <option>16:45</option>
                                <option>17:00</option>
                                <option>17:15</option>
                                <option>17:30</option>
                                <option>17:45</option>
                                <option>18:00</option>
                                <option>18:15</option>
                                <option>18:30</option>
                                <option>18:45</option>
                                <option>19:00</option>
                                <option>19:15</option>
                                <option>19:30</option>
                                <option>19:45</option>
                                <option>20:00</option>
                                <option>20:15</option>
                                <option>20:30</option>
                                <option>20:45</option>
                                <option>21:00</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="summary">Summary of work</label>
                            <input id="summary" class="form-control" required="" onClick="this.select();">
                        </div>
                        <div class="form-group">
                            <label for="amount">Amount (e.g. 12.95)</label>
                            <input id="amount" class="form-control"required="" onClick="this.select();">
                        </div>
                        <div id="createBookEntryError" class="alert alert-danger" role="alert">
                            Populate fields correctly!
                        </div>
                        <button id="createBookEntry" type="button" class="btn btn-default btn-primary inputMargin" type="submit">Add Book Entry</button>
                        <button id="updateBookEntry" type="button" class="btn btn-default btn-primary inputMargin" type="submit">Update Book Entry</button>
                    </div>
                </div>
            </form>
        </div>

        <div id="findCustomer" class="col-md-12 clear">
            <form autocomplete="off">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Find Customer</h3>
                    </div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label for="filter" class="sr-only">Search filter</label>
                            <input id="filter" class="form-control" required="" autofocus="">
                        </div>
                        <div id="results">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Select</th>
                                        <th>Name</th>
                                        <th>Address line 1</th>
                                        <th>Town</th>
                                    </tr>
                                </thead>
                                <tbody id="resultsBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div id="bookEntries" class="col-md-12 clear">
            <div id="bookEntriesSummary">
                <h4 style="padding-top: 5px">Total Amount: £<span id="total"></span></h4>
                <h4>Total Miles: <span id="totalMiles"></span></h4>
            </div>
            <div id="bookEntriesBody"></div>
        </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha384-nvAa0+6Qg9clwYCGGPpDQLVpLNn0fRaROjHqs13t4Ggj3Ez50XnGQqc/r8MhnRDZ" crossorigin="anonymous"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
    <script type="text/JavaScript">
    $(function() {
        initialise();
    });
    </script>
  </body>
</html>
